<!DOCTYPE html>
<html>
    <head>
        <title>Asterisk Project : Upgrading to Asterisk 12</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">Asterisk Project</a></span>
                            </li>
                                                    <li>
                                <span><a href="Asterisk-12-Documentation_25919697.html">Asterisk 12 Documentation</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            Asterisk Project : Upgrading to Asterisk 12
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                                                Added by  mjordan , edited by  mjordan  on Dec 19, 2013
                    </div>
                    <div id="main-content" class="wiki-content group">
                        <div class="aui-message problem shadowed information-macro">
                            <span class="aui-icon icon-problem">Icon</span>
                <div class="message-content">
                            <p>There are many significant architectural changes in Asterisk 12. It is recommended that you not only read through this document for important changes that affect an upgrade, but that you also read through the <a href="http://svn.asterisk.org/svn/asterisk/branches/12/CHANGES" class="external-link" rel="nofollow">CHANGES</a> document and the information about what is <a href="New-in-12_26476750.html">New in 12</a> to better understand the new options available to you.</p>
                    </div>
    </div>
<h1 id="UpgradingtoAsterisk12-UpgradeOverview"><span style="line-height: 1.4285715;">Upgrade Overview</span></h1><p><span style="line-height: 1.4285715;">Of particular note, the following systems in Asterisk underwent significant </span><span style="line-height: 1.4285715;">changes. Documentation for the changes and a specification for their </span><span style="line-height: 1.4285715;">behavior in Asterisk 12 are available in the <a href="Asterisk-12-Documentation_25919697.html">Asterisk 12 Documentation</a> section on this wiki.</span></p><ul><li><strong>AMI:</strong> Many events were changed, and the semantics of channels and bridges <span style="line-height: 1.4285715;">were defined. In particular, how channels and bridges behave under </span><span style="line-height: 1.4285715;">transfer scenarios and situations involving multiple parties has </span><span style="line-height: 1.4285715;">changed significantly. See </span><a href="https://wiki.asterisk.org/wiki/x/dAFRAQ" style="line-height: 1.4285715;" rel="nofollow">t</a>he <a href="AMI-v2-Specification_22086004.html">AMI v2 Specification</a> <span style="line-height: 1.4285715;">for more information.</span></li><li><span style="line-height: 1.4285715;"><strong>CDRs:</strong> CDR logic was extracted from the many locations it existed in across </span><span style="line-height: 1.4285715;">Asterisk and implemented as a consumer of Stasis message bus events. </span><span style="line-height: 1.4285715;">As a result, consistency of records has improved significantly and the </span><span style="line-height: 1.4285715;">behavior of CDRs in transfer scenarios has been defined in the CDR </span><span style="line-height: 1.4285715;">specification. However, significant behavioral changes in CDRs resulted </span><span style="line-height: 1.4285715;">from the transition. The most significant change is the addition of </span><span style="line-height: 1.4285715;">CDR entries when a channel who is the Party A in a CDR leaves a bridge. </span><span style="line-height: 1.4285715;">See the <a href="Asterisk-12-CDR-Specification_22088359.html">Asterisk 12 CDR Specification</a> for more information.</span></li><li><span style="line-height: 1.4285715;"><strong>CEL:</strong> Much like CDRs, CEL was removed from the many locations it existed in </span><span style="line-height: 1.4285715;">across Asterisk and implemented as a consumer of Stasis message bus </span><span style="line-height: 1.4285715;">events. It now closely follows the Bridging API model of channels and </span><span style="line-height: 1.4285715;">bridges, and has a much closer consistency of conveyed events as AMI. </span><span style="line-height: 1.4285715;">For the changes in events, see the <a href="Asterisk-12-CEL-Specification_25919712.html">Asterisk 12 CEL Specification</a>.</span></li></ul><h1 id="UpgradingtoAsterisk12-UpgradeChanges">Upgrade Changes</h1><h2 id="UpgradingtoAsterisk12-BuildSystem%3A">Build System:</h2><ul><li>Removed the CHANNEL_TRACE development mode build option. Certain aspects of <span style="line-height: 1.4285715;">the CHANNEL_TRACE build option were incompatible with the new bridging </span><span style="line-height: 1.4285715;">architecture.</span></li><li>Asterisk now depends on <code>libjansson</code>, <code>libuuid</code> and optionally (but recommended) <code>libxslt</code><span style="line-height: 1.4285715;"> and <code>uriparser</code>.</span></li><li>The new SIP stack and channel driver uses a particular version of PJSIP. <span style="line-height: 1.4285715;">Please see <a href="Installing-pjproject_25919783.html">Installing pjproject</a> for more information on installing and configuring PJSIP for use with Asterisk 12.</span></li></ul><p><span style="color: rgb(133,120,102);font-family: MuseoSans500 , sans-serif;font-size: 20.0px;line-height: 1.5;"><a href="Asterisk-12-Application_AgentLogin_26476795.html">AgentLogin</a>, <a href="Asterisk-12-Application_AgentRequest_26476796.html">AgentRequest</a>, and chan_agent:</span></p><ul><li>Along with <a href="Asterisk-12-Application_AgentRequest_26476796.html">AgentRequest</a>, this application has been modified to be a replacement for <code>chan_agent</code>. The <code>chan_agent</code> module and the Agent channel driver have been removed from Asterisk, as the concept of a channel driver proxying in front of another channel driver was incompatible with the new architecture (and has had numerous problems through past versions of Asterisk). The act of a channel calling the <a href="Asterisk-12-Application_AgentLogin_26476795.html">AgentLogin</a> application places the channel into a pool of agents that can be requested by the AgentRequest application. Note that this application, as well as all other agent related functionality, is now provided by the <code>app_agent_pool</code> module.</li><li><span style="line-height: 1.4285715;">This application no longer performs agent authentication. If authentication </span><span style="line-height: 1.4285715;">is desired, the dialplan needs to perform this function using the </span><span style="line-height: 1.4285715;"><a href="Asterisk-12-Application_Authenticate_26476802.html">Authenticate</a> or <a href="Asterisk-12-Application_VMAuthenticate_26476974.html">VMAuthenticate</a> application or through an AGI script before </span><span style="line-height: 1.4285715;">running AgentLogin.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">The <code><a href="Asterisk-12-Configuration_app_agent_pool_26477436.html">agents.conf</a></code> schema has changed. Rather than specifying agents on a </span><span style="line-height: 1.4285715;">single line in comma delineated fashion, each agent is defined in a separate </span><span style="line-height: 1.4285715;">context. This allows agents to use the power of context templates in their </span><span style="line-height: 1.4285715;">definition.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">A number of parameters from <code>agents.conf</code> have been removed. This includes <code>maxloginretries</code></span><span style="line-height: 1.4285715;">, <code>autologoffunavail</code>, <code>updatecdr</code>, <code>goodbye</code>, <code>group</code>, <code>recordformat</code>, <code>urlprefix</code></span><span style="line-height: 1.4285715;">, and <code>savecallsin</code>. These options were obsoleted by the move from </span><span style="line-height: 1.4285715;">a channel driver model to the bridging/application model provided by <code>app_agent_pool</code></span><span style="line-height: 1.4285715;">.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">The <code>AGENTUPDATECDR</code> channel variable has also been removed, for the same </span><span style="line-height: 1.4285715;">reason as the <code>updatecdr</code> option.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">The <code>endcall</code> and <code>enddtmf</code> configuration options are removed. Use the </span><span style="line-height: 1.4285715;">dialplan function <code>CHANNEL(dtmf-features)</code> to set DTMF features on the agent </span><span style="line-height: 1.4285715;">channel before calling AgentLogin.</span></li></ul><h2 id="UpgradingtoAsterisk12-AgentMonitorOutgoing"><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">AgentMonitorOutgoing</span></h2><ul><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">This application has been removed. It was a holdover from when </span><span style="line-height: 1.4285715;">AgentCallbackLogin was removed.</span></li></ul><h2 id="UpgradingtoAsterisk12-Answer"><a href="Asterisk-12-Application_Answer_26477162.html">Answer</a></h2><ul><li>It is no longer possible to bypass updating the CDR when answering a channel. CDRs are based on the channel state and will be updated when the channel is Answered.</li></ul><h2 id="UpgradingtoAsterisk12-ControlPlayback"><a href="Asterisk-12-Application_ControlPlayback_26476825.html">ControlPlayback</a></h2><ul><li>The channel variable <code>CPLAYBACKSTATUS</code> may now return the value <code>REMOTESTOPPED</code> when playback is stopped by an external entity.</li></ul><h2 id="UpgradingtoAsterisk12-DISA"><a href="Asterisk-12-Application_DISA_26476837.html">DISA</a></h2><ul><li>This application now has a dependency on the app_cdr module. It uses this module to hide the CDR created prior to execution of the DISA application.</li></ul><h2 id="UpgradingtoAsterisk12-DumpChan%3A"><a href="Asterisk-12-Application_DumpChan_26476838.html">DumpChan</a>:</h2><ul><li>The output of DumpChan no longer includes the <em>DirectBridge</em> or <em>IndirectBridge</em> fields. Instead, if a channel is in a bridge, it includes a <em>BridgeID</em> field containing the unique ID of the bridge that the channel happens to be in.</li></ul><h2 id="UpgradingtoAsterisk12-ForkCDR%3A"><a href="Asterisk-12-Application_ForkCDR_26476849.html">ForkCDR</a>: </h2><ul><li>Nearly every parameter in ForkCDR has been updated and changed to reflect the changes in CDRs. Please see the documentation for the <a href="Asterisk-12-Application_ForkCDR_26476849.html">ForkCDR</a> application, as well as the <a href="Asterisk-12-CDR-Specification_22088359.html">CDR specification</a>.</li></ul><h2 id="UpgradingtoAsterisk12-NoCDR%3A"><a href="Asterisk-12-Application_NoCDR_26476804.html">NoCDR</a>:</h2><ul><li>The NoCDR application has been deprecated. Please use the <a href="Asterisk-12-Function_CDR_PROP_26477002.html">CDR_PROP</a> function to disable CDRs on a channel.</li></ul><h2 id="UpgradingtoAsterisk12-ParkAndAnnounce%3A"><a href="Asterisk-12-Application_ParkAndAnnounce_26478089.html">ParkAndAnnounce</a>:</h2><ul><li>The <code>app_parkandannounce</code> module has been removed. The application ParkAndAnnounce is now provided by the res_parking module. See the Parking changes for more information.</li></ul><h2 id="UpgradingtoAsterisk12-ResetCDR%3A"><a href="Asterisk-12-Application_ResetCDR_26476805.html">ResetCDR</a>:</h2><ul><li>The <code>w</code> and <code>a</code> options have been removed. Dispatching CDRs to registered backends occurs on an as-needed basis in order to preserve linkedid propagation and other needed behavior.</li><li>The <code>e</code> option is deprecated. Please use the <a href="Asterisk-12-Function_CDR_PROP_26477002.html">CDR_PROP</a> function to enable CDRs on a channel that they were previously disabled on.</li><li>The <a href="Asterisk-12-Application_ResetCDR_26476805.html">ResetCDR</a> application is no longer a part of core Asterisk, and instead is now delivered as part of <code>app_cdr</code>.</li></ul><h2 id="UpgradingtoAsterisk12-Queues%3A"><span style="line-height: 1.4285715;"><a href="Asterisk-12-Application_Queue_26476897.html">Queues</a>:</span></h2><ul><li><span style="line-height: 1.4285715;">Queue strategy <code>rrmemory</code> now has a predictable order similar to strategy <code>rrordered</code></span><span style="line-height: 1.4285715;">. Members will be called in the order that they are added to the </span><span style="line-height: 1.4285715;">queue.</span></li><li><span style="line-height: 1.4285715;">Removed the <code>queues.conf</code> <code>check_state_unknown</code> option. It is no longer </span><span style="line-height: 1.4285715;">necessary.</span></li><li><span style="line-height: 1.4285715;">It is now possible to play the Queue prompts to the first user waiting in a </span><span style="line-height: 1.4285715;">call queue. Note that this may impact the ability for agents to talk with </span><span style="line-height: 1.4285715;">users, as a prompt may still be playing when an agent connects to the user. </span><span style="line-height: 1.4285715;">This ability is disabled by default but can be enabled on an individual </span><span style="line-height: 1.4285715;">queue using the <code>announce-to-first-user</code> option.</span></li><li><span style="line-height: 1.4285715;">The configuration options <code>eventwhencalled</code> and <code>eventmemberstatus</code> have been </span><span style="line-height: 1.4285715;">removed. As a result, the AMI events <a href="Asterisk-12-ManagerEvent_QueueMemberStatus_26477356.html">QueueMemberStatus</a>, <a href="Asterisk-12-ManagerEvent_AgentCalled_26477325.html">AgentCalled</a>, </span><span style="line-height: 1.4285715;"><a href="Asterisk-12-ManagerEvent_AgentConnect_26477355.html">AgentConnect</a>, <a href="Asterisk-12-ManagerEvent_AgentComplete_26477368.html">AgentComplete</a>, <a href="Asterisk-12-ManagerEvent_AgentDump_26477362.html">AgentDump</a>, and <a href="Asterisk-12-ManagerEvent_AgentRingNoAnswer_26477314.html">AgentRingNoAnswer</a> will always be </span><span style="line-height: 1.4285715;">sent. The <em>Variable</em> fields will also no longer exist on the <em>Agent*</em> events. </span><span style="line-height: 1.4285715;">These events can be filtered out from a connected AMI client using the <code>eventfilter</code></span> setting in <code>manager.conf</code>.</li><li>The queue log now differentiates between blind and attended transfers. A blind transfer will result in a <code>BLINDTRANSFER</code> message with the destination context and extension. An attended transfer will result in an <code>ATTENDEDTRANSFER</code> message. This message will indicate the method by which the attended transfer was completed: <code>BRIDGE</code> for a bridge merge, <code>APP</code> for running an application on a bridge or channel, or <code>LINK</code> for linking two bridges together with local channels. The queue log will also now detect externally initiated blind and attended transfers and record the transfer status accordingly.</li><li>When performing queue pause/unpause on an interface without specifying an individual queue, the <code>PAUSEALL</code>/ <code>UNPAUSEALL</code> event will only be logged if at least one member of any queue exists for that interface.</li></ul><h2 id="UpgradingtoAsterisk12-SetAMAFlags"><a href="Asterisk-12-Application_SetAMAFlags_26477185.html">SetAMAFlags</a></h2><ul><li>This application is deprecated in favor of <a href="Asterisk-12-Function_CHANNEL_26477005.html">CHANNEL(amaflags).</a></li></ul><h2 id="UpgradingtoAsterisk12-VoiceMail%3A"><a href="Asterisk-12-Application_VoiceMail_26476971.html">VoiceMail</a>: </h2><ul><li>The <em>voicemail.conf</em> configuration file now has an <code>alias</code> configuration parameter for use with the <a href="Asterisk-12-Application_Directory_26476836.html">Directory</a> application. The voicemail realtime database table schema has also been updated with an 'alias' column. Systems using voicemail with realtime should update their schemas accordingly.</li><li>Mailboxes defined by <code>app_voicemail</code> <strong>MUST</strong> be referenced by the rest of the system as <code>mailbox@context</code>.  The rest of the system cannot add <code>@default</code> to mailbox identifiers for <code>app_voicemail</code> that do not specify a context any longer.  It is a mailbox identifier format that should only be interpreted by <code>app_voicemail</code>.</li></ul><h2 id="UpgradingtoAsterisk12-ChannelDrivers%3A">Channel Drivers:</h2><ul><li>When a channel driver is configured to enable jiterbuffers, they are now applied unconditionally when a channel joins a bridge. If a jitterbuffer is already set for that channel when it enters, such as by the <a href="Asterisk-12-Function_JITTERBUFFER_26477041.html">JITTERBUFFER</a> function, then the existing jitterbuffer will be used and the one set by the channel driver will not be applied.</li></ul><h2 id="UpgradingtoAsterisk12-chan_bridge"><span style="line-height: 1.4285715;">chan_bridge</span></h2><ul><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">chan_bridge is removed and its functionality is incorporated into <a href="Asterisk-12-Application_ConfBridge_26476812.html">ConfBridge</a> </span><span style="line-height: 1.4285715;">itself.</span></li></ul><h2 id="UpgradingtoAsterisk12-chan_dahdi%3A">chan_dahdi:</h2><ul><li>Analog port dialing and deferred DTMF dialing for PRI now distinguishes between <code>w</code> and <code>W</code>. The <code>w</code> pauses dialing for half a second. The <code>W</code> pauses dialing for one second.</li><li><span style="line-height: 1.4285715;">The default for <code>inband_on_proceeding</code> has changed to no.</span></li><li><span style="line-height: 1.4285715;">The CLI command <code>dahdi destroy channel</code> is now <code>dahdi destroy channels</code>. </span><span style="line-height: 1.4285715;">A range of channels can be specified to be destroyed. Note that this command </span><span style="line-height: 1.4285715;">should only be used if you understand the risks it entails.</span></li><li><span style="line-height: 1.4285715;">The script specified by the <code>chan_dahdi.conf</code> <code>mwimonitornotify</code> option now gets the exact configured mailbox name.  For <code>app_voicemail</code> mailboxes this is <code>mailbox@context</code>.</span></li><li><span style="line-height: 1.4285715;">Added <code>mwi_vm_boxes</code> that also must be configured for ISDN MWI to be enabled.<br /></span></li></ul><h2 id="UpgradingtoAsterisk12-chan_local%3A"><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">chan_local:</span></h2><ul><li>The <code>/b</code> option has been removed.</li><li><span style="line-height: 1.4285715;"><code>chan_local</code> moved into the system core and is no longer a loadable module.</span></li></ul><h2 id="UpgradingtoAsterisk12-chan_sip%3A">chan_sip:</h2><ul><li>The <code>callevents</code> parameter has been removed. <a href="Asterisk-12-ManagerEvent_Hold_26477330.html">Hold</a> AMI events are now raised in the core, and can be filtered out using the <code>eventfilter</code> parameter in <em>manager.conf</em>.</li><li><span style="line-height: 1.4285715;">Dynamic realtime tables for SIP Users can now include a <code>path</code> field. This </span><span style="line-height: 1.4285715;">will store the path information for that peer when it registers. Realtime </span><span style="line-height: 1.4285715;">tables can also use the <code>supportpath</code> field to enable Path header support.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">LDAP realtime configurations for SIP Users now have the <code>AstAccountPathSupport</code> <code>objectIdentifier</code></span><span style="line-height: 1.4285715;">. This maps to the <code>supportpath</code> option in <em>sip.conf</em>.</span></li></ul><h2 id="UpgradingtoAsterisk12-Core%3A"><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">Core:</span></h2><ul><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">Masquerades as an operation inside Asterisk have been effectively hidden </span><span style="line-height: 1.4285715;">by the migration to the Bridging API. As such, many 'quirks' of Asterisk </span><span style="line-height: 1.4285715;">no longer occur. This includes renaming of channels, &quot;&lt;ZOMBIE&gt;&quot; channels, </span><span style="line-height: 1.4285715;">dropping of frame/audio hooks, and other internal implementation details </span><span style="line-height: 1.4285715;">that users had to deal with. This fundamental change has large implications </span><span style="line-height: 1.4285715;">throughout the changes documented for this version. For more information </span><span style="line-height: 1.4285715;">about the new core architecture of Asterisk, please see the Asterisk wiki.</span></li><li><span style="line-height: 1.4285715;">The following channel variables have changed behavior which is described in </span><span style="line-height: 1.4285715;">the CHANGES file: <code>TRANSFER_CONTEXT</code>, <code>BRIDGEPEER</code>, <code>BRIDGEPVTCALLID</code>, <code>ATTENDED_TRANSFER_COMPLETE_SOUND</code></span><span style="line-height: 1.4285715;">, <code>DYNAMIC_FEATURENAME</code>, and <code>DYNAMIC_PEERNAME</code>.</span></li><li><span style="line-height: 1.4285715;">All bridging in Asterisk is now performed using the Bridging API, which is the same bridging core that powers the ConfBridge application. As a result, significant changes have been made in all areas of Asterisk that are affected by bridging. Those changes are noted in the appropriate areas.</span></li></ul><h2 id="UpgradingtoAsterisk12-AMI%28AsteriskManagerInterface%29%3A"><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">AMI (Asterisk Manager Interface):</span></h2><ul><li><span style="line-height: 1.4285715;">The Version has been increased to 1.4. For a full listing of the semantics changes in AMI, see the <a href="AMI-v2-Specification_22086004.html">AMI v2 Specification</a>.</span></li><li><span style="line-height: 1.4285715;">The details of what happens to a channel when a masquerade </span><span style="line-height: 1.4285715;">happens (transfers, parking, etc) have changed. </span><span style="line-height: 1.4285715;">Channels no longer swap Uniqueid's as a result of the masquerade. In general, AMI clients will never actually &quot;see&quot; a masquerade, as the operation has been effectively hidden from external systems.</span></li><li><strong>Major</strong> changes were made to both the syntax as well as the semantics of the AMI protocol. In particular, AMI events have been substantially modified and improved in this version of Asterisk. The major event changes are listed below:<ul><li>NewPeerAccount has been removed. <a href="Asterisk-12-ManagerEvent_NewAccountCode_26477336.html">NewAccountCode</a> is raised instead.</li><li><a href="Asterisk-12-ManagerEvent_Reload_26477376.html">Reload</a> events have been consolidated and standardized.</li><li>ModuleLoadReport has been removed.</li><li>FaxSent is now <a href="Asterisk-12-ManagerEvent_SendFAX_26477309.html">SendFAX</a>; FaxReceived is now <a href="Asterisk-12-ManagerEvent_ReceiveFAX_26477324.html">ReceiveFAX</a>. This standardizes <code>app_fax</code><span style="line-height: 1.4285715;"> and <code>res_fax</code> events.</span></li><li><span style="line-height: 1.4285715;">MusicOnHold has been replaced with <a href="Asterisk-12-ManagerEvent_MusicOnHoldStart_26477341.html">MusicOnHoldStart</a> and <a href="Asterisk-12-ManagerEvent_MusicOnHoldStop_26477381.html">MusicOnHoldStop</a>.</span></li><li><span style="line-height: 1.4285715;">JabberEvent has been removed.</span></li><li><span style="line-height: 1.4285715;">Hold is now in the core and will now raise <a href="Asterisk-12-ManagerEvent_Hold_26477330.html">Hold</a> and <a href="Asterisk-12-ManagerEvent_Unhold_26477380.html">Unhold</a> events.</span></li><li><span style="line-height: 1.4285715;">Join is now <a href="Asterisk-12-ManagerEvent_QueueCallerJoin_26477358.html">QueueCallerJoin</a>.</span></li><li><span style="line-height: 1.4285715;">Leave is now <a href="Asterisk-12-ManagerEvent_QueueCallerLeave_26477337.html">QueueCallerLeave</a>.</span></li><li><span style="line-height: 1.4285715;">Agentlogin/Agentlogoff is now <a href="Asterisk-12-ManagerEvent_AgentLogin_26477378.html">AgentLogin</a>/<a href="Asterisk-12-ManagerEvent_AgentLogoff_26477372.html">AgentLogoff</a>, respectively.</span></li><li><span style="line-height: 1.4285715;">ChannelUpdate has been removed.</span></li><li><span style="line-height: 1.4285715;">Local channel optimization is now conveyed via <a href="Asterisk-12-ManagerEvent_LocalOptimizationBegin_26477384.html">LocalOptimizationBegin</a> and </span><span style="line-height: 1.4285715;"><a href="Asterisk-12-ManagerEvent_LocalOptimizationEnd_26477306.html">LocalOptimizationEnd</a>.</span></li><li>BridgeAction and BridgeExec have been removed.</li><li><a href="Asterisk-12-ManagerEvent_BlindTransfer_26477345.html">BlindTransfer</a> and <a href="Asterisk-12-ManagerEvent_AttendedTransfer_26477350.html">AttendedTransfer</a> events were added.</li><li>Dial is now <a href="Asterisk-12-ManagerEvent_DialBegin_26477331.html">DialBegin</a> and <a href="Asterisk-12-ManagerEvent_DialEnd_26477333.html">DialEnd</a>.</li><li>DTMF is now <a href="Asterisk-12-ManagerEvent_DTMFBegin_26477316.html">DTMFBegin</a> and <a href="Asterisk-12-ManagerEvent_DTMFEnd_26477386.html">DTMFEnd</a>.</li><li>Bridge has been replaced with <a href="Asterisk-12-ManagerEvent_BridgeCreate_26477367.html">BridgeCreate</a>, <a href="Asterisk-12-ManagerEvent_BridgeEnter_26477312.html">BridgeEnter</a>, <a href="Asterisk-12-ManagerEvent_BridgeLeave_26477359.html">BridgeLeave</a>, and <span style="line-height: 1.4285715;"><a href="Asterisk-12-ManagerEvent_BridgeDestroy_26477307.html">BridgeDestroy</a></span></li><li><span style="line-height: 1.4285715;">The Masquerade event is no longer raised. The <a href="Asterisk-12-ManagerEvent_Rename_26477339.html">Rename</a> event still exists, but only silly channel drivers (<code>chan_misdn</code>) will ever think of raising it, and you shouldn't be using <code>chan_misdn</code> anyway.</span></li><li><span style="line-height: 1.4285715;">MusicOnHold has been replaced with <a href="Asterisk-12-ManagerEvent_MusicOnHoldStart_26477341.html">MusicOnHoldStart</a> and <a href="Asterisk-12-ManagerEvent_MusicOnHoldStop_26477381.html">MusicOnHoldStop</a></span></li><li><span style="line-height: 1.4285715;">AGIExec is now <a href="Asterisk-12-ManagerEvent_AGIExecStart_26477326.html">AGIExecStart</a> and <a href="Asterisk-12-ManagerEvent_AGIExecEnd_26477323.html">AGIExecEnd</a></span></li><li><span style="line-height: 1.4285715;">AsyncAGI is now <a href="Asterisk-12-ManagerEvent_AsyncAGIStart_26477322.html">AsyncAGIStart</a>, <a href="Asterisk-12-ManagerEvent_AsyncAGIExec_26477328.html">AsyncAGIExec</a>, and <a href="Asterisk-12-ManagerEvent_AsyncAGIEnd_26477340.html">AsyncAGIEnd</a></span></li></ul></li><li><span style="line-height: 1.4285715;">The <a href="Asterisk-12-ManagerEvent_MCID_26477327.html">MCID</a> AMI event now publishes a channel snapshot when available and </span><span style="line-height: 1.4285715;">its non-channel-snapshot parameters now use either the <em>MCallerID</em> or </span><span style="line-height: 1.4285715;"><em>MConnectedID</em> prefixes with <em>Subaddr*</em>, <em>Name*</em>, and<em> Num*</em> suffixes instead </span><span style="line-height: 1.4285715;">of <em>CallerID</em> and <em>ConnectedID</em> to avoid confusion with similarly named </span><span style="line-height: 1.4285715;">parameters in the channel snapshot.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">The <em>Channel</em> key used in the <a href="Asterisk-12-ManagerEvent_AlarmClear_26477385.html">AlarmClear</a>, <a href="Asterisk-12-ManagerEvent_Alarm_26477375.html">Alarm</a>, and <a href="Asterisk-12-ManagerEvent_DNDState_26477374.html">DNDState</a> has been </span><span style="line-height: 1.4285715;">renamed <em>DAHDIChannel</em> since it does not convey an Asterisk channel name.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">All AMI events now contain a <em>SystemName</em> field, if available.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">Local channel information in events is now prefixed with <em>LocalOne</em> and </span><span style="line-height: 1.4285715;"><em>LocalTwo</em>. This replaces the suffix of '1' and '2' for the two halves of </span><span style="line-height: 1.4285715;">the Local channel. This affects the <a href="Asterisk-12-ManagerEvent_LocalBridge_26477301.html">LocalBridge</a>, <a href="Asterisk-12-ManagerEvent_LocalOptimizationBegin_26477384.html">LocalOptimizationBegin</a>, </span><span style="line-height: 1.4285715;">and <a href="Asterisk-12-ManagerEvent_LocalOptimizationEnd_26477306.html">LocalOptimizationEnd</a> events.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">The <a href="Asterisk-12-ManagerEvent_RTCPSent_26477377.html">RTCPSent</a>/<a href="Asterisk-12-ManagerEvent_RTCPReceived_26477363.html">RTCPReceived</a> events have been significantly modified from </span><span style="line-height: 1.4285715;">previous versions. They now report all SR/RR packets sent/received, and </span><span style="line-height: 1.4285715;">have been restructured to better reflect the data sent in a SR/RR. In </span><span style="line-height: 1.4285715;">particular, the event structure now supports multiple report blocks.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">The deprecated use of | (pipe) as a separator in the <code>channelvars</code> setting in </span><span style="line-height: 1.4285715;"><em>manager.conf</em> has been removed.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">The SIP <a href="Asterisk-12-ManagerAction_SIPqualifypeer_26476782.html">SIPqualifypeer</a> action now sends a response indicating it will qualify </span><span style="line-height: 1.4285715;">a peer once a peer has been found to qualify. Once the qualify has been </span><span style="line-height: 1.4285715;">completed it will now issue a <a href="Asterisk-12-ManagerEvent_SIPQualifyPeerDone_26477320.html">SIPqualifypeerdone</a> event.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">The AMI event <a href="Asterisk-12-ManagerEvent_NewExten_26477317.html">Newexten</a> field <em>Extension</em> is deprecated, and may be removed </span><span style="line-height: 1.4285715;">in a future release. Please use the common <em>Exten</em> field instead.</span></li><li><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">The AMI events <a href="Asterisk-12-ManagerEvent_ParkedCall_26478103.html">ParkedCall</a>, <a href="Asterisk-12-ManagerEvent_ParkedCallTimeOut_26478092.html">ParkedCallTimeOut</a>, <a href="Asterisk-12-ManagerEvent_ParkedCallGiveUp_26478101.html">ParkedCallGiveUp</a>, and </span><span style="line-height: 1.4285715;"><a href="Asterisk-12-ManagerEvent_UnParkedCall_26478099.html">UnParkedCall</a> have changed significantly in the new <code>res_parking</code> module.</span><ul><li><span style="line-height: 1.4285715;">The <em>Channel</em> and <em>From</em> headers are gone. For the channel that was parked </span><span style="line-height: 1.4285715;">or is coming out of parking, a <em>Parkee</em> channel snapshot is issued and it </span><span style="line-height: 1.4285715;">has a number of fields associated with it. The old <em>Channel</em> header relayed </span><span style="line-height: 1.4285715;">the same data as the new <em>ParkeeChannel</em> header.</span></li><li><span style="line-height: 1.4285715;">The <em>From</em> field was ambiguous and changed meaning depending on the event. </span><span style="line-height: 1.4285715;">For most of these, it was the name of the channel that parked the call </span><span style="line-height: 1.4285715;">(the <em>Parker</em>). There is no longer a header that provides this channel name, </span><span style="line-height: 1.4285715;">however the <em>ParkerDialString</em> will contain a dialstring to redial the </span><span style="line-height: 1.4285715;">device that parked the call.</span></li><li><span style="line-height: 1.4285715;">On <a href="Asterisk-12-ManagerEvent_UnParkedCall_26478099.html">UnParkedCall</a> events, the <em>From</em> header would instead represent the </span><span style="line-height: 1.4285715;">channel responsible for retrieving the <em>parkee</em>. It receives a channel </span><span style="line-height: 1.4285715;">snapshot labeled <em>Retriever</em>. The <em>from</em> field is is replaced with </span><span style="line-height: 1.4285715;"><em>RetrieverChannel</em>.</span></li><li><span style="line-height: 1.4285715;">Lastly, the <em>Exten</em> field has been replaced with <em>ParkingSpace</em>.</span></li></ul></li><li><span style="line-height: 1.4285715;">The AMI event Parkinglot (response to <a href="Asterisk-12-ManagerAction_Parkinglots_26478084.html">Parkinglots</a> command) in a similar </span><span style="line-height: 1.4285715;">fashion has changed the field names <em>StartExten</em> and <em>StopExten</em> to </span><span style="line-height: 1.4285715;"><em>StartSpace</em> and <em>StopSpace</em> respectively.</span></li><li><span style="line-height: 1.4285715;">The AMI <a href="Asterisk-12-ManagerEvent_Status_26477357.html">Status</a> response event to the AMI <a href="Asterisk-12-ManagerAction_Status_26477126.html">Status</a> action replaces the </span><span style="line-height: 1.4285715;"><em>BridgedChannel</em> and <em>BridgedUniqueid</em> headers with the <em>BridgeID</em> header to </span><span style="line-height: 1.4285715;">indicate what bridge the channel is currently in.</span></li></ul><h2 id="UpgradingtoAsterisk12-CDR%28CallDetailRecords%29"><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">CDR (Call Detail Records)</span></h2><ul><li><span style="line-height: 1.4285715;">Significant changes have been made to the behavior of CDRs. The CDR engine </span><span style="line-height: 1.4285715;">was effectively rewritten and built on the Stasis message bus. For a full </span><span style="line-height: 1.4285715;">definition of CDR behavior in Asterisk 12, please read the <a href="Asterisk-12-CDR-Specification_22088359.html">Asterisk 12 CDR Specification</a>.</span><span style="line-height: 1.4285715;"> </span></li><li>CDRs will now be created between all participants in a bridge. For each pair of channels in a bridge, a CDR is created to represent the path of communication between those two endpoints. This lets an end user choose who to bill for what during bridge operations with multiple parties.</li><li><span style="line-height: 1.4285715;">The duration, billsec, start, answer, and end times now reflect the times </span><span style="line-height: 1.4285715;">associated with the current CDR for the channel, as opposed to a cumulative </span><span style="line-height: 1.4285715;">measurement of all CDRs for that channel.</span></li><li><span style="line-height: 1.4285715;"><span style="line-height: 1.4285715;"> </span></span>CDR backends can no longer be unloaded while billing data is in flight. This helps to prevent loss of billing data during restarts and shutdowns.<span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;"><span style="line-height: 1.4285715;"> </span></span><span style="line-height: 1.4285715;"><span style="line-height: 1.4285715;"> </span></span><span style="line-height: 1.4285715;"><span style="line-height: 1.4285715;"> </span></span><span style="line-height: 1.4285715;"> </span></li></ul><h2 id="UpgradingtoAsterisk12-CEL%3A"><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">CEL:</span></h2><ul><li><span style="line-height: 1.4285715;">The <em>Uniqueid</em> field for a channel is now a stable identifier, and will not c</span><span style="line-height: 1.4285715;">hange due to transfers, parking, etc.</span></li><li><span style="line-height: 1.4285715;">CEL has undergone significant rework in Asterisk 12, and is now built on the </span><span style="line-height: 1.4285715;">Stasis message bus. Please see the <a href="Asterisk-12-CEL-Specification_25919712.html">Asterisk 12 CEL Specification</a></span><span style="line-height: 1.4285715;"> for more detailed </span><span style="line-height: 1.4285715;">information. A summary of the affected events is below:</span><ul><li><code>BRIDGE_START</code>, <code>BRIDGE_END</code>, <code>BRIDGE_UPDATE</code>, <code>3WAY_START</code>, <code>3WAY_END</code>, <code>CONF_ENTER</code>, <code>CONF_EXIT</code>, <code>CONF_START</code>, and <code>CONF_END</code> events have all been removed. These events have been replaced by <code>BRIDGE_ENTER</code>/ <code>BRIDGE_EXIT</code>.</li><li><span style="line-height: 1.4285715;"><code>BLINDTRANSFER</code>/ <code>ATTENDEDTRANSFER</code> events now report the peer as NULL and </span><span style="line-height: 1.4285715;">additional information in the extra string field.</span></li></ul></li></ul><h2 id="UpgradingtoAsterisk12-Dialplan%3A"><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">Dialplan:</span></h2><ul><li><span style="line-height: 1.4285715;">All channel and global variable names are evaluated in a case-sensitive manner. In previous versions of Asterisk, variables created and evaluated in the dialplan were evaluated case-insensitively, but built-in variables and variable evaluation done internally within Asterisk was done case-sensitively.</span></li><li><span style="line-height: 1.4285715;">Asterisk has always had code to ignore dash '-' characters that are not part of a character set in the dialplan extensions. The code now consistently ignores these characters when matching dialplan extensions. </span></li><li><span style="line-height: 1.4285715;"><code>BRIDGE_FEATURES</code> channel variable is now case sensitive for feature letter </span><span style="line-height: 1.4285715;">codes. Uppercase variants apply them to the calling party while lowercase </span><span style="line-height: 1.4285715;">variants apply them to the called party.</span></li></ul><h2 id="UpgradingtoAsterisk12-"><span style="line-height: 1.4285715;"> </span></h2><h2 id="UpgradingtoAsterisk12-DialplanFunctions%3A">Dialplan Functions:</h2><h2 id="UpgradingtoAsterisk12-.1"><span style="line-height: 1.4285715;"> </span></h2><h2 id="UpgradingtoAsterisk12-.2"><span style="line-height: 1.4285715;"> </span></h2><ul><li>Certain dialplan functions have been marked as 'dangerous', and may only be executed from the dialplan. Execution from extenal sources (AMI's GetVar and SetVar actions; etc.) may be inhibited by setting live_dangerously in the [options] section of asterisk.conf to no. SHELL(), channel locking, andirect file read/write functions are marked as dangerous. DB_DELETE() and REALTIME_DESTROY() are marked as dangerous for reads, but can now safely accept writes (which ignore the provided value).</li></ul><h2 id="UpgradingtoAsterisk12-.3"><span style="line-height: 1.4285715;"> </span></h2><h2 id="UpgradingtoAsterisk12-Features%3A"><span style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">Features:</span></h2><ul><li><span style="line-height: 1.4285715;">The <a href="Asterisk-12-Configuration_features_26477757.html"><em>features.conf</em></a> <code>[applicationmap] &lt;FeatureName&gt; ActivatedBy</code> option is </span><span style="line-height: 1.4285715;">no longer honored. The feature is always activated by the channel that has <code>DYNAMIC_FEATURES</code></span><span style="line-height: 1.4285715;"> defined on it when it enters the bridge. Use <a href="https://wiki.asterisk.org/wiki/display/AST/Pre-Dial+Handlers">predial</a> to set </span><span style="line-height: 1.4285715;">different values of <code>DYNAMIC_FEATURES</code> on the channels</span></li><li><span style="line-height: 1.4285715;">Executing a dynamic feature on the bridge peer in a multi-party bridge will </span><span style="line-height: 1.4285715;">execute it on all peers of the activating channel.</span></li><li><span style="line-height: 1.4285715;">There is no longer an explicit <code>features reload</code> CLI command. Features can </span><span style="line-height: 1.4285715;">still be reloaded using <code>module reload features</code>.</span></li><li><span style="line-height: 1.4285715;">It is no longer necessary (or possible) to define the ATXFER_NULL_TECH in<em> </em></span><span style="line-height: 1.4285715;"><em>features.c</em> for <code>atxferdropcall=no</code> to work properly. This option now just </span><span style="line-height: 1.4285715;">works.</span></li></ul><h2 id="UpgradingtoAsterisk12-Parking%3A">Parking:</h2><ul><li>Parking has been extracted from the Asterisk core as a loadable module, <code>res_parking</code>.</li><li>Configuration is found in<em> res_parking.conf</em>. It is no longer supported in <em>features.conf</em></li><li>The arguments for the <a href="Asterisk-12-Application_Park_26478087.html">Park</a>, <a href="Asterisk-12-Application_ParkedCall_26478088.html">ParkedCall</a>, and <a href="Asterisk-12-Application_ParkAndAnnounce_26478089.html">ParkAndAnnounce</a> applications have been modified significantly. See the application documents for specific details.</li><li>Numerous changes to Parking related applications, AMI and CLI commands and internal inter-workings have been made. Please read the CHANGES file or the <a href="New-in-12_26476750.html">New in 12</a> page for the detailed list.</li></ul><h2 id="UpgradingtoAsterisk12-SecurityEventsFramework%3A">Security Events Framework:</h2><ul><li>Security Event timestamps now use ISO 8601 formatted date/time instead of the &quot;seconds-microseconds&quot; format that it was using previously.</li></ul><h2 id="UpgradingtoAsterisk12-AGENT%3A"><a href="Asterisk-12-Function_AGENT_26476797.html">AGENT</a>:</h2><ul><li>The password option has been disabled, as the <a href="Asterisk-12-Application_AgentLogin_26476795.html">AgentLogin</a> application no longer provides authentication.</li></ul><h2 id="UpgradingtoAsterisk12-AUDIOHOOK_INHERIT%3A"><a href="Asterisk-12-Function_AUDIOHOOK_INHERIT_26476992.html">AUDIOHOOK_INHERIT</a>:</h2><ul><li>Due to changes in the Asterisk core, this function is no longer needed to preserve a <a href="Asterisk-12-Application_MixMonitor_26476879.html">MixMonitor</a> on a channel during transfer operations and dialplan execution. It is effectively obsolete.</li></ul><h2 id="UpgradingtoAsterisk12-CDR%3A%28function%29"><a href="Asterisk-12-Function_CDR_26477001.html">CDR</a>: (function)</h2><ul><li>The <code>amaflags</code> and <code>accountcode</code> attributes for the CDR function are deprecated. Use the <a href="Asterisk-12-Function_CHANNEL_26477005.html">CHANNEL</a> function instead to access these attributes.</li><li><span style="line-height: 1.4285715;">The <code>l</code> option has been removed. When reading a CDR attribute, the most </span><span style="line-height: 1.4285715;">recent record is always used. When writing a CDR attribute, all non-finalized </span><span style="line-height: 1.4285715;">CDRs are updated.</span></li><li>The <code>r</code> option has been removed, for the same reason as the <code>l</code> option.</li><li><span style="line-height: 1.4285715;">The <code>s</code> option has been removed, as <code>LOCKED</code> semantics no longer exist in the </span><span style="line-height: 1.4285715;">CDR engine.</span></li></ul><h2 id="UpgradingtoAsterisk12-VMCOUNT%3A">VMCOUNT:</h2><ul><li>Mailboxes defined by <code>app_voicemail</code> <strong>MUST</strong> be referenced by the rest of the system as <code>mailbox@context</code>.  The rest of the system cannot add <code>@default</code> to mailbox identifiers for <code>app_voicemail</code> that do not specify a context any longer.  It is a mailbox identifier format that should only be interpreted by <code>app_voicemail</code>.</li></ul><h2 id="UpgradingtoAsterisk12-res_rtp_asterisk%3A">res_rtp_asterisk:</h2><ul><li>ICE/STUN/TURN support in <code>res_rtp_asterisk</code> has been made optional. To enable them, an Asterisk-specific version of PJSIP needs to be installed. Tarballs are available from <a href="https://github.com/asterisk/pjproject/tags/" class="external-link" rel="nofollow">https://github.com/asterisk/pjproject/tags/</a>.</li></ul><p> </p>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer">
                <section class="footer-body">
                    <p>Document generated by Confluence on Dec 20, 2013 14:14</p>
                </section>
            </div>
        </div>     </body>
</html>
